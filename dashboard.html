<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Dispatcher Live Alerts</title>
    <style>
        body { font-family: Arial, sans-serif; margin: 20px; }
        h2 { text-align: center; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ccc; padding: 8px; text-align: left; }
        th { background-color: #f0f0f0; }
        tr.high { background-color: #f8d7da; }      /* red = high urgency */
        tr.medium { background-color: #fff3cd; }   /* yellow = medium urgency */
        tr.low { background-color: #d4edda; }      /* green = low urgency */
    </style>
</head>
<body>
    <h2>Live Disaster Alerts</h2>
    <table>
        <thead>
            <tr>
                <th>Timestamp</th>
                <th>Message</th>
                <th>Urgency</th>
                <th>Location</th>
                <th>Needs</th>
            </tr>
        </thead>
        <tbody id="alerts"></tbody>
    </table>

    <script>
        // Adjust the WebSocket URL if using a different IP or port
        const ws = new WebSocket("ws://127.0.0.1:8000/alerts");
        const tbody = document.getElementById("alerts");

        ws.onopen = () => {
            console.log("✅ Connected to WebSocket server!");
        };

        ws.onmessage = (event) => {
            const alert = JSON.parse(event.data);
            const tr = document.createElement("tr");

            // Color-code urgency
            if (alert.urgency_score >= 30) tr.className = "high";
            else if (alert.urgency_score >= 15) tr.className = "medium";
            else tr.className = "low";

            tr.innerHTML = `
                <td>${new Date(alert.timestamp).toLocaleString()}</td>
                <td>${alert.message}</td>
                <td>${alert.urgency_score}</td>
                <td>${alert.location ? alert.location.join(", ") : "Unknown"}</td>
                <td>${alert.needs.join(", ")}</td>
            `;

            // Add newest alert on top
            tbody.prepend(tr);
        };

        ws.onclose = () => {
            console.log("⚠️ WebSocket connection closed");
        };

        ws.onerror = (err) => {
            console.error("WebSocket error:", err);
        };
    </script>
</body>
</html>